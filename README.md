# Interval Learn Bot

Телеграм-бот, который принимает ваши сообщения и формирует интервальные повторения в указанном канале. Поддерживает текст, фото и видео, хранит состояние в SQLite и реализует алгоритм SM-2 с кнопками «Снова / Сложно / Хорошо / Легко».

## Возможности
- Ответ на каждое входящее сообщение инлайн-кнопками «Добавить в обучение / Отмена».
- Сохранение исходного сообщения и пересылка его в канал по расписанию (через webhook не требуется — используется long polling).
- Кнопки с оценкой интервала прямо под постом в канале; результат влияет на следующую дату повторения.
- Консольное логирование, `.env` для локальной разработки и GitHub Secrets/переменные Railway для продакшена.

## Требования
- Node.js 18+
- SQLite (встроенный, файл создаётся автоматически в `data/bot.db`)
- Переменные окружения:
  - `BOT_TOKEN` — токен Telegram-бота от BotFather.
  - `CHAT_ID` — ID канала, куда бот будет публиковать напоминания (формат `-100...`).
  - Необязательно: `INITIAL_REVIEW_MINUTES`, `REVIEW_SCAN_INTERVAL_MS`, `REVIEW_BATCH_SIZE`.

Создайте локальный `.env` на основе шаблона:

```bash
cp .env.example .env
# заполните BOT_TOKEN и CHAT_ID
```

## Локальный запуск

```bash
npm install
npm run dev          # запускает tsx watch

# либо собрать и запустить production-режим
npm run build
npm start
```

Во время работы автоматически создаётся файл `data/bot.db`. Добавьте бота администратором в канал, указанный в `CHAT_ID`, чтобы он мог публиковать сообщения и обрабатывать нажатие кнопок.

## Архитектура
- `src/bot.ts` — обработчики Telegram: intake сообщений, подтверждение добавления, обработка оценок.
- `src/db.ts` — слой хранения на SQLite (карточки и статусы повторений).
- `src/reviewScheduler.ts` — периодическая проверка `next_review_at` и публикация карточек в канал.
- `src/spacedRepetition.ts` — SM-2 с поддержкой 4 оценок.
- `src/index.ts` — точка входа, связывает бота, БД и планировщик.

## Railway деплой
1. Убедитесь, что репозиторий находится на GitHub и содержит этот код.
2. В [Railway](https://railway.app/) создайте новый проект → Deploy from GitHub repo → выберите репозиторий.
3. В разделе **Variables** задайте:
   - `BOT_TOKEN`
   - `CHAT_ID`
   - (опционально) `INITIAL_REVIEW_MINUTES`, `REVIEW_SCAN_INTERVAL_MS`, `REVIEW_BATCH_SIZE`
4. В разделе **Settings → Deployments** убедитесь, что Build Command оставлен по умолчанию (Railway выполнит `npm install && npm run build`). Start Command должен быть `npm run start`.
5. Добавьте бота админом в нужный канал, чтобы он мог публиковать сообщения.
6. Перезапустите сервис. Логи доступны в Railway → Logs.

> **Примечание:** Railway сохраняет локальные файлы до следующего деплоя. База `data/bot.db` будет жить в контейнере, но при пересборке контейнера очистится. Для долгосрочного хранения можно позже подключить, например, Railway Postgres.

## Скрипты
- `npm run dev` — запуск в режиме разработки (hot reload).
- `npm run lint` — проверка типов TypeScript.
- `npm run build` — компиляция в `dist/`.
- `npm start` — запуск продакшн-сборки.

## Дополнительно
- `docs/clarification-questions.md` — финализированное ТЗ и ответы на вопросы.
- `docs/hosting-options.md` — сравнительная таблица бесплатных хостингов.
